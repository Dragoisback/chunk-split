<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Novel Term Extractor v3.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            --bg-color: #f4f7f9;
            --card-bg-color: #ffffff;
            --primary-color: #4A90E2; /* Professional Blue */
            --primary-hover-color: #357ABD;
            --secondary-color: #50E3C2; /* Teal accent for success */
            --secondary-hover-color: #38C1A5;
            --tertiary-color: #9013FE; /* Purple for specific actions */
            --tertiary-hover-color: #7B0FD0;
            --text-primary: #2c3e50; /* Dark Grey Blue */
            --text-secondary: #7f8c8d; /* Lighter Grey */
            --border-color: #dfe6e9;
            --shadow-color: rgba(44, 62, 80, 0.1);
            --success-color: var(--secondary-color);
            --error-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: var(--primary-color);
            --font-family: 'Inter', sans-serif;
            --base-font-size: 16px;
            --border-radius: 8px;
            --transition-speed: 0.25s;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: var(--base-font-size);
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
        }

        .app-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 25px 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--tertiary-color));
            color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 6px 12px var(--shadow-color);
        }
        .app-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        .app-header p {
            font-size: 1rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        @media (min-width: 992px) {
            .main-layout {
                grid-template-columns: 1fr 1fr; /* Two columns for inputs */
            }
            .full-width-panel {
                grid-column: 1 / -1; /* Span across both columns */
            }
        }
        
        .panel {
            background-color: var(--card-bg-color);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 8px var(--shadow-color);
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }
        .panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px var(--shadow-color);
        }
        .panel-header {
            display: flex;
            align-items: center;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        .panel-header i { margin-right: 10px; }

        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        textarea, .file-input-display {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.95rem;
            font-family: var(--font-family);
            background-color: #fdfdfe;
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
            resize: vertical;
        }
        textarea:focus, .file-input-display:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
            outline: none;
        }
        
        .file-input-container {
            position: relative;
        }
        .file-input-container input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        .file-input-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            cursor: pointer;
        }
        .file-input-display .placeholder { color: var(--text-secondary); }
        .file-input-display i { color: var(--primary-color); }

        .button-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 15px; /* Smaller padding for normal buttons */
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background-color var(--transition-speed) ease, transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
            box-shadow: 0 2px 4px var(--shadow-color);
        }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 3px 6px var(--shadow-color); }
        .btn:active { transform: translateY(0); box-shadow: 0 1px 2px var(--shadow-color); }

        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: var(--primary-hover-color); }

        .btn-secondary { background-color: var(--secondary-color); color: white; }
        .btn-secondary:hover { background-color: var(--secondary-hover-color); }
        
        .btn-tertiary { background-color: var(--tertiary-color); color: white; }
        .btn-tertiary:hover { background-color: var(--tertiary-hover-color); }
        
        .btn-danger { background-color: var(--error-color); color: white; }
        .btn-danger:hover { background-color: #c0392b; }

        .btn-icon { padding: 8px 10px; } /* Even smaller for icon only */
        .btn-icon .btn-text { display: none; }
        @media (min-width: 768px) {
            .btn-icon.responsive-text .btn-text { display: inline; margin-left: 5px; }
        }


        .main-action-panel { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color); }
        .main-action-button {
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .main-action-button .spinner {
            display: none; width: 18px; height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%; border-top-color: #fff;
            animation: spin 0.8s ease-in-out infinite;
        }
        .main-action-button.loading .spinner { display: inline-block; }
        .main-action-button.loading .btn-text { margin-left: 8px; }

        @keyframes spin { to { transform: rotate(360deg); } }

        .toggle-switch-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px; /* Smaller switch */
            height: 24px;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s; border-radius: 24px;
        }
        .slider:before {
            position: absolute; content: "";
            height: 18px; width: 18px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(20px); }


        .status-message {
            margin-top: 10px; padding: 10px 15px; border-radius: 6px;
            font-size: 0.9rem; display: flex; align-items: center;
            gap: 8px; border: 1px solid transparent;
        }
        .status-message i { font-size: 1.1em; }
        .status-message.success { background-color: #e6fff8; color: #008d6e; border-color: var(--success-color); }
        .status-message.warning { background-color: #fff8e1; color: #c47d00; border-color: var(--warning-color); }
        .status-message.error   { background-color: #fdecea; color: #c03329; border-color: var(--error-color); }
        .status-message.info    { background-color: #e7f3fe; color: #357ABD; border-color: var(--info-color); }

        .instructions {
            font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 15px;
            padding: 10px; background-color: #f8f9fa;
            border-left: 3px solid var(--secondary-color); border-radius: 4px;
        }
        
        #processingStatusLog ul { list-style-type: none; padding-left: 0; max-height: 150px; overflow-y: auto;}
        #processingStatusLog li { padding: 4px 0; font-size: 0.85rem; border-bottom: 1px dotted #eee;}
        #processingStatusLog li:last-child { border-bottom: none; }

        .output-actions {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden; width: 100px;
            background-color: #555; color: #fff; text-align: center;
            border-radius: 6px; padding: 5px 0;
            position: absolute; z-index: 1; bottom: 125%; left: 50%;
            margin-left: -50px; opacity: 0; transition: opacity 0.3s;
        }
        .tooltip .tooltiptext::after {
            content: ""; position: absolute; top: 100%; left: 50%;
            margin-left: -5px; border-width: 5px; border-style: solid;
            border-color: #555 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1;}

        .app-footer {
            text-align: center; padding: 20px; font-size: 0.9rem;
            color: var(--text-secondary); border-top: 1px solid var(--border-color); margin-top: 40px;
        }

    </style>
</head>
<body>
    <header class="app-header">
        <h1><i class="fas fa-rocket"></i> Elite Novel Term Extractor v3.0</h1>
        <p>Advanced Chapter Parsing, Deduplication, and Custom Output Formatting</p>
    </header>

    <div class="main-layout">
        <!-- JSON Input Panel -->
        <div class="panel json-input-panel">
            <div class="panel-header"><i class="fas fa-file-alt"></i>Chapter Data Input</div>
            <div class="instructions">
                Paste JSON arrays for chapters below. <strong>Separate each chapter's JSON block with at least one blank line.</strong>
            </div>
            <div class="form-group">
                <label for="jsonInput">Chapters' JSON Data:</label>
                <textarea id="jsonInput" rows="15" placeholder="[{"id":0, "terms":[...]}, ...] 

(Blank line) 

[{"id":0, "terms":[...]}, ...]"></textarea>
            </div>
            <div id="jsonStatus" class="status-message" style="display:none;"></div>
        </div>

        <!-- Deduplication List Panel -->
        <div class="panel deduplication-panel">
            <div class="panel-header"><i class="fas fa-tasks"></i>Deduplication List (Optional)</div>
            <div class="instructions">
                Provide an existing list to exclude terms. Format: <code>raw, translation[, gender]</code>. Match is on English translation (case-insensitive).
            </div>
            <div class="form-group">
                <label for="csvFile">Upload CSV file:</label>
                <div class="file-input-container">
                    <input type="file" id="csvFile" accept=".csv" onchange="updateFileNameDisplay(this)">
                    <div class="file-input-display">
                        <span id="fileNamePlaceholder">Choose a .csv file...</span>
                        <i class="fas fa-paperclip"></i>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="pastedCsv">Or paste CSV content (and copy from here):</label>
                <textarea id="pastedCsv" rows="7" placeholder="大明, Great Ming, Neuter
道人, Daoist, Male"></textarea>
            </div>
            <div class="button-row">
                <button onclick="loadExternalList()" class="btn btn-secondary"><i class="fas fa-list-check"></i>Load List</button>
                <button onclick="clearExternalList()" class="btn btn-danger"><i class="fas fa-eraser"></i>Clear</button>
                <div class="tooltip">
                    <button onclick="copyToClipboard('pastedCsv', 'dedupeTooltip')" class="btn btn-tertiary btn-icon responsive-text">
                        <i class="fas fa-copy"></i><span class="btn-text">Copy List</span>
                    </button>
                    <span class="tooltiptext" id="dedupeTooltip">Copy to clipboard</span>
                </div>
            </div>
            <div id="externalListStatus" class="status-message" style="margin-top:15px; display:none;"></div>
        </div>

        <!-- Action and Output Panel -->
        <div class="panel full-width-panel">
            <div class="panel-header"><i class="fas fa-cogs"></i>Actions & Results</div>
            
            <div class="main-action-panel">
                <div class="button-row" style="justify-content: space-between; margin-bottom: 20px;">
                     <button onclick="processAllData()" class="btn btn-primary main-action-button">
                        <span class="btn-text"><i class="fas fa-bolt"></i>Extract Terms</span>
                        <span class="spinner"></span>
                    </button>
                    <div class="toggle-switch-container">
                        <label for="addPresetToggle" style="font-size:0.9rem; margin-bottom: 0;">Add Header Preset:</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="addPresetToggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div id="processingStatusLog" class="status-message info" style="display:none; margin-top: 0;">
                <strong>Processing Log:</strong>
                <ul id="processingSteps"></ul>
            </div>

            <hr style="border: none; border-top: 1px solid var(--border-color); margin: 25px 0;">
            
            <div class="output-actions">
                <div class="tooltip">
                    <button onclick="copyToClipboard('outputText', 'outputTooltip')" class="btn btn-tertiary btn-icon responsive-text">
                        <i class="fas fa-copy"></i><span class="btn-text">Copy Output</span>
                    </button>
                    <span class="tooltiptext" id="outputTooltip">Copy to clipboard</span>
                </div>
            </div>
            <div class="form-group">
                <label for="outputText">Extracted Terms:</label>
                <textarea id="outputText" rows="15" readonly placeholder="Results will appear here..."></textarea>
            </div>
            <div id="outputSummary" class="status-message" style="display:none;"></div>
        </div>
    </div>

    <footer class="app-footer">
        <p>© 2024 Elite Term Extractor. Precision Engineered.</p>
    </footer>

    <script>
        let externalListTranslations = new Set();
        const PRESET_TEXT = `"Before replying YOU must think. From now onwards, in your thinking process/thought process/strategizing instead of YOU doing regular thinking, it is imperative that YOU MUST open and activate "Super-Duper-Hyper Thinking Mode". In this mode, you are obligated to: 1) engage in extreme exceptionally extreme thinking 2) engage in extreme exceptionally extreme extensivity 3) extreme exceptionally extreme extensity analysis."
 Go through the whole chat and check what have you translated these in your translation. add pinyin, where and its description and gender about it too. Mention if the  term is not present or cut in half. compare to my translation and let me know the difference reason.`;


        function displayStatus(elementId, message, type, iconClass = '') {
            const el = document.getElementById(elementId);
            const iconHtml = iconClass ? `<i class="fas ${iconClass}" style="margin-right:5px;"></i>` : '';
            el.innerHTML = `${iconHtml} ${message}`;
            el.className = 'status-message ' + type;
            el.style.display = 'flex';
        }
        
        function hideStatus(elementId) {
            const el = document.getElementById(elementId);
            el.style.display = 'none';
        }

        function updateFileNameDisplay(fileInput) {
            const placeholder = document.getElementById('fileNamePlaceholder');
            if (fileInput.files.length > 0) {
                placeholder.textContent = fileInput.files[0].name;
                placeholder.style.color = 'var(--text-primary)';
            } else {
                placeholder.textContent = 'Choose a .csv file...';
                placeholder.style.color = 'var(--text-secondary)';
            }
        }
        
        function addProcessingStep(message, type = 'info') {
            const logContainer = document.getElementById('processingStatusLog');
            logContainer.style.display = 'block'; // Ensure it's visible
            const stepsList = document.getElementById('processingSteps');
            const listItem = document.createElement('li');
            
            let icon = 'fa-info-circle'; 
            let color = 'var(--info-color)';
            if (type === 'success') { icon = 'fa-check-circle'; color = 'var(--success-color)'; }
            else if (type === 'error') { icon = 'fa-times-circle'; color = 'var(--error-color)'; }
            else if (type === 'warning') { icon = 'fa-exclamation-triangle'; color = 'var(--warning-color)'; }

            listItem.innerHTML = `<i class="fas ${icon}" style="margin-right: 8px; color: ${color};"></i> ${message}`;
            stepsList.appendChild(listItem);
            stepsList.scrollTop = stepsList.scrollHeight; // Auto-scroll
        }

        function clearProcessingLog() {
            document.getElementById('processingSteps').innerHTML = '';
            hideStatus('processingStatusLog');
        }


        function loadExternalList() {
            const fileInput = document.getElementById('csvFile');
            const pastedCsv = document.getElementById('pastedCsv').value;
            
            externalListTranslations.clear(); 

            const processCsvContent = (csvContent) => {
                const lines = csvContent.split('\n');
                let count = 0;
                let invalidLines = 0;
                lines.forEach(line => {
                    if (line.trim() === '') return; 
                    const parts = line.split(',').map(part => part.trim());
                    if (parts.length >= 2 && parts[1]) { 
                        externalListTranslations.add(parts[1].toLowerCase());
                        count++;
                    } else {
                        invalidLines++;
                    }
                });

                if (count > 0) {
                    displayStatus('externalListStatus', `${count} terms loaded. ${invalidLines > 0 ? invalidLines + ' invalid lines.' : ''}`, 'success', 'fa-check-circle');
                } else if (csvContent.trim() !== '' && invalidLines > 0) {
                     displayStatus('externalListStatus', 'No valid terms. Format: raw,translation[,gender].', 'warning', 'fa-exclamation-triangle');
                } else if (csvContent.trim() !== '') {
                     displayStatus('externalListStatus', 'Dedupe list empty or invalid.', 'warning', 'fa-exclamation-triangle');
                }
                else {
                    displayStatus('externalListStatus', 'Dedupe list empty.', 'info', 'fa-info-circle');
                }
            };

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                if (file.type !== "text/csv" && !file.name.endsWith(".csv") && file.type !== "application/vnd.ms-excel") {
                     displayStatus('externalListStatus', 'Invalid file type. Use .csv.', 'error', 'fa-times-circle');
                     fileInput.value = ''; 
                     updateFileNameDisplay(fileInput);
                     return;
                }
                const reader = new FileReader();
                reader.onload = (event) => processCsvContent(event.target.result);
                reader.onerror = () => displayStatus('externalListStatus', 'Error reading file.', 'error', 'fa-times-circle');
                reader.readAsText(file);
            } else if (pastedCsv.trim() !== '') {
                processCsvContent(pastedCsv);
            } else {
                displayStatus('externalListStatus', 'No dedupe list provided.', 'info', 'fa-info-circle');
            }
        }

        function clearExternalList() {
            externalListTranslations.clear();
            const fileInput = document.getElementById('csvFile');
            fileInput.value = ''; 
            updateFileNameDisplay(fileInput);
            document.getElementById('pastedCsv').value = ''; 
            displayStatus('externalListStatus', 'Dedupe list cleared.', 'info', 'fa-eraser');
        }

        async function processAllData() {
            const extractButton = document.querySelector('.main-action-button');
            extractButton.classList.add('loading');
            extractButton.disabled = true;

            clearProcessingLog();
            addProcessingStep("Initializing extraction...");

            const jsonInputString = document.getElementById('jsonInput').value;
            const outputTextarea = document.getElementById('outputText');
            
            outputTextarea.value = ''; 
            hideStatus('jsonStatus');
            hideStatus('outputSummary');

            if (!jsonInputString.trim()) {
                displayStatus('jsonStatus', "JSON input is empty.", 'warning', 'fa-exclamation-triangle');
                addProcessingStep("JSON input empty. Aborted.", 'error');
                finalizeExtraction(extractButton); return;
            }

            const chapterJsonStrings = jsonInputString.split(/\n\s*\n/).filter(s => s.trim() !== "");
            addProcessingStep(`Detected ${chapterJsonStrings.length} chapter block(s).`);

            if (chapterJsonStrings.length === 0) {
                displayStatus('jsonStatus', "No chapter blocks found (separate by blank lines).", 'warning', 'fa-exclamation-triangle');
                addProcessingStep("No chapter blocks. Aborted.", 'error');
                finalizeExtraction(extractButton); return;
            }

            let allChunks = [];
            let chaptersSuccessfullyParsed = 0;

            for (let i = 0; i < chapterJsonStrings.length; i++) {
                const chapterStr = chapterJsonStrings[i];
                addProcessingStep(`Parsing Chapter ${i + 1}...`);
                await new Promise(resolve => setTimeout(resolve, 20)); 

                try {
                    const parsedChapter = JSON.parse(chapterStr);
                    if (!Array.isArray(parsedChapter)) {
                        addProcessingStep(`Chapter ${i + 1} not a JSON array. Skipped.`, 'error'); continue;
                    }
                     const firstChunk = parsedChapter[0];
                    if (parsedChapter.length > 0 && (typeof firstChunk !== 'object' || firstChunk === null || !('id' in firstChunk) || !Array.isArray(firstChunk.terms))) {
                        addProcessingStep(`Chapter ${i+1} chunk structure error. Skipped.`, 'warning'); continue;
                    }
                    allChunks.push(...parsedChapter);
                    chaptersSuccessfullyParsed++;
                    addProcessingStep(`Chapter ${i + 1} parsed (${parsedChapter.length} chunks).`, 'success');
                } catch (error) {
                    addProcessingStep(`Error in Chapter ${i + 1} JSON: ${error.message}. Skipped.`, 'error');
                }
            }
            
            if (chaptersSuccessfullyParsed === 0 && chapterJsonStrings.length > 0) {
                 displayStatus('jsonStatus', `Failed to parse any chapter blocks.`, 'error', 'fa-times-circle');
                 addProcessingStep("All chapter parsing failed. Aborted.", 'error');
                 finalizeExtraction(extractButton); return;
            }
            addProcessingStep(`${chaptersSuccessfullyParsed} chapter(s) processed. Extracting terms...`);
            await new Promise(resolve => setTimeout(resolve, 20)); 

            const extractedTermsList = [];
            const seenTranslationsInJson = new Set(); 

            allChunks.forEach(chunk => {
                if (chunk && Array.isArray(chunk.terms)) {
                    chunk.terms.forEach(term => {
                        if (term && typeof term.raw === 'string' && typeof term.translation === 'string') {
                            const raw = term.raw;
                            const translation = term.translation;
                            const translationKey = translation.toLowerCase();

                            if (externalListTranslations.has(translationKey) || seenTranslationsInJson.has(translationKey)) return; 
                            
                            seenTranslationsInJson.add(translationKey);
                            let gender = "Neuter";
                            if (Array.isArray(term.tags)) {
                                if (term.tags.includes("#male")) gender = "Male";
                                else if (term.tags.includes("#female")) gender = "Female";
                            }
                            extractedTermsList.push(`${raw}, ${translation}, ${gender}`);
                        }
                    });
                }
            });
            
            let finalOutputString = "";
            if (document.getElementById('addPresetToggle').checked) {
                finalOutputString += PRESET_TEXT + "\n\n";
                 addProcessingStep("Preset header added.", 'info');
            }

            if (extractedTermsList.length > 0) {
                finalOutputString += extractedTermsList.join('\n');
                outputTextarea.value = finalOutputString;
                displayStatus('outputSummary', `Extraction Complete! ${extractedTermsList.length} unique terms.`, 'success', 'fa-check-double');
                addProcessingStep(`Extracted ${extractedTermsList.length} unique terms.`, 'success');
            } else {
                if (document.getElementById('addPresetToggle').checked) { // If only preset is there
                     outputTextarea.value = finalOutputString;
                }
                displayStatus('outputSummary', `Processed ${chaptersSuccessfullyParsed} chapter(s). No new unique terms found.`, 'info', 'fa-info-circle');
                addProcessingStep("No new unique terms.", 'info');
            }
            finalizeExtraction(extractButton);
        }

        function finalizeExtraction(button) {
            button.classList.remove('loading');
            button.disabled = false;
        }

        function copyToClipboard(elementId, tooltipId) {
            const textarea = document.getElementById(elementId);
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                navigator.clipboard.writeText(textarea.value).then(() => {
                    const tooltip = document.getElementById(tooltipId);
                    const originalText = tooltip.textContent;
                    tooltip.textContent = "Copied!";
                    setTimeout(() => { tooltip.textContent = originalText; }, 1500);
                }).catch(err => {
                    console.error('Fallback: Oops, unable to copy via navigator.clipboard', err);
                     // Fallback for older browsers (less reliable)
                    try {
                        document.execCommand('copy');
                        const tooltip = document.getElementById(tooltipId);
                        const originalText = tooltip.textContent;
                        tooltip.textContent = "Copied!";
                        setTimeout(() => { tooltip.textContent = originalText; }, 1500);
                    } catch (execErr) {
                        console.error('Fallback execCommand: Oops, unable to copy', execErr);
                        const tooltip = document.getElementById(tooltipId);
                        const originalText = tooltip.textContent;
                        tooltip.textContent = "Copy Failed!";
                        setTimeout(() => { tooltip.textContent = originalText; }, 1500);
                    }
                });
            } catch (e) {
                console.error('Error with navigator.clipboard: ', e);
                 // Fallback for older browsers or environments without navigator.clipboard
                 try {
                    document.execCommand('copy');
                    const tooltip = document.getElementById(tooltipId);
                    const originalText = tooltip.textContent;
                    tooltip.textContent = "Copied!";
                    setTimeout(() => { tooltip.textContent = originalText; }, 1500);
                } catch (execErr) {
                    console.error('Fallback execCommand: Oops, unable to copy', execErr);
                    const tooltip = document.getElementById(tooltipId);
                    const originalText = tooltip.textContent;
                    tooltip.textContent = "Copy Failed!";
                    setTimeout(() => { tooltip.textContent = originalText; }, 1500);
                }
            }
        }
    </script>
</body>
</html>
